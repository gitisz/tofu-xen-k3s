---
apiVersion: traefik.io/v1alpha1
kind: ServersTransport
metadata:
  name: kubernetes-dashboard-transport
  namespace: kubernetes-dashboard

spec:
  serverName: kubernetes-dashboard
  insecureSkipVerify: true

---
apiVersion: traefik.io/v1alpha1
kind: IngressRoute
metadata:
  name: dashboard-https
  namespace: kubernetes-dashboard
spec:
  entryPoints:
    - websecure
  routes:
    - match: Host(`kubernetes-dashboard.${kubernetes_cloudflare_dns_zone}`) && PathPrefix(`/api/v1/login`)
      kind: Rule
      services:
        - name: kubernetes-dashboard-auth
          port: 8000
    - match: Host(`kubernetes-dashboard.${kubernetes_cloudflare_dns_zone}`) && PathPrefix(`/api/v1/csrftoken/login`)
      kind: Rule
      services:
        - name: kubernetes-dashboard-auth
          port: 8000
    - match: Host(`kubernetes-dashboard.${kubernetes_cloudflare_dns_zone}`) && PathPrefix(`/api/v1/me`)
      kind: Rule
      services:
        - name: kubernetes-dashboard-auth
          port: 8000
    - match: Host(`kubernetes-dashboard.${kubernetes_cloudflare_dns_zone}`) && PathPrefix(`/api`)
      kind: Rule
      services:
        - name: kubernetes-dashboard-api
          port: 8000
    - match: Host(`kubernetes-dashboard.${kubernetes_cloudflare_dns_zone}`) && PathPrefix(`/metrics`)
      kind: Rule
      services:
        - name: kubernetes-dashboard-api
          port: 8000
    - match: Host(`kubernetes-dashboard.${kubernetes_cloudflare_dns_zone}`) && PathPrefix(`/`)
      kind: Rule
      services:
        - name: kubernetes-dashboard-web
          port: 8000
  tls:
    secretName: kubernetes-dashboard-${kubernetes_dashboard_cloudflare_dns_secret_name_prefix}-${kubernetes_dashboard_issuer_environment}-tls
